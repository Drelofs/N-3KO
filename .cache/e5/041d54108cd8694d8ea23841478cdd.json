{"id":"c2nI","dependencies":[{"name":"/Users/julia/Documents/GitHub/N-3KO/package.json","includedInParent":true,"mtime":1557756471451},{"name":"/Users/julia/Documents/GitHub/N-3KO/node_modules/phaser/package.json","includedInParent":true,"mtime":1557756490182},{"name":"../../../utils/Class","loc":{"line":8,"column":20},"parent":"/Users/julia/Documents/GitHub/N-3KO/node_modules/phaser/src/renderer/webgl/pipelines/ForwardDiffuseLightPipeline.js","resolved":"/Users/julia/Documents/GitHub/N-3KO/node_modules/phaser/src/utils/Class.js"},{"name":"../shaders/ForwardDiffuse-frag.js","loc":{"line":9,"column":29},"parent":"/Users/julia/Documents/GitHub/N-3KO/node_modules/phaser/src/renderer/webgl/pipelines/ForwardDiffuseLightPipeline.js","resolved":"/Users/julia/Documents/GitHub/N-3KO/node_modules/phaser/src/renderer/webgl/shaders/ForwardDiffuse-frag.js"},{"name":"./TextureTintPipeline","loc":{"line":10,"column":34},"parent":"/Users/julia/Documents/GitHub/N-3KO/node_modules/phaser/src/renderer/webgl/pipelines/ForwardDiffuseLightPipeline.js","resolved":"/Users/julia/Documents/GitHub/N-3KO/node_modules/phaser/src/renderer/webgl/pipelines/TextureTintPipeline.js"}],"generated":{"js":"var t=require(\"../../../utils/Class\"),e=require(\"../shaders/ForwardDiffuse-frag.js\"),r=require(\"./TextureTintPipeline\"),i=10,a=new t({Extends:r,initialize:function(t){i=t.maxLights,t.fragShader=e.replace(\"%LIGHT_COUNT%\",i.toString()),r.call(this,t),this.defaultNormalMap,this.inverseRotationMatrix=new Float32Array([1,0,0,0,1,0,0,0,1])},boot:function(){this.defaultNormalMap=this.game.textures.getFrame(\"__DEFAULT\")},onBind:function(t){r.prototype.onBind.call(this);var e=this.renderer,i=this.program;return this.mvpUpdate(),e.setInt1(i,\"uNormSampler\",1),e.setFloat2(i,\"uResolution\",this.width,this.height),t&&this.setNormalMap(t),this},onRender:function(t,e){this.active=!1;var r=t.sys.lights;if(!r||r.lights.length<=0||!r.active)return this;var a=r.cull(e),s=Math.min(a.length,i);if(0===s)return this;this.active=!0;var o,n=this.renderer,l=this.program,h=e.matrix,u={x:0,y:0},d=n.height;for(o=0;o<i;++o)n.setFloat1(l,\"uLights[\"+o+\"].radius\",0);for(n.setFloat4(l,\"uCamera\",e.x,e.y,e.rotation,e.zoom),n.setFloat3(l,\"uAmbientLightColor\",r.ambientColor.r,r.ambientColor.g,r.ambientColor.b),o=0;o<s;++o){var c=a[o],m=\"uLights[\"+o+\"].\";h.transformPoint(c.x,c.y,u),n.setFloat2(l,m+\"position\",u.x-e.scrollX*c.scrollFactorX*e.zoom,d-(u.y-e.scrollY*c.scrollFactorY*e.zoom)),n.setFloat3(l,m+\"color\",c.r,c.g,c.b),n.setFloat1(l,m+\"intensity\",c.intensity),n.setFloat1(l,m+\"radius\",c.radius)}return this},batchTexture:function(t,e,r,i,a,s,o,n,l,h,u,d,c,m,p,x,g,f,v,M,y,T,F,N,b,R,S,w,C,I){var X;if(this.active)if(this.renderer.setPipeline(this),t.displayTexture?X=t.displayTexture.dataSource[t.displayFrame.sourceIndex]:t.texture?X=t.texture.dataSource[t.frame.sourceIndex]:t.tileset&&(X=t.tileset.image.dataSource[0]),X){this.setTexture2D(X.glTexture,1),this.setNormalMapRotation(u);var Y=this._tempMatrix1,_=this._tempMatrix2,L=this._tempMatrix3,P=f/r+S,D=v/i+w,z=(f+M)/r+S,U=(v+y)/i+w,q=o,A=n,O=-x,B=-g;if(t.isCropped){var E=t._crop;q=E.width,A=E.height,o=E.width,n=E.height;var G=f=E.x,H=v=E.y;d&&(G=M-E.x-E.width),c&&!e.isRenderTexture&&(H=y-E.y-E.height),P=G/r+S,D=H/i+w,z=(G+E.width)/r+S,U=(H+E.height)/i+w,O=-x+f,B=-g+v}d&&(q*=-1,O+=o),(c^=e.isRenderTexture?1:0)&&(A*=-1,B+=n);var j=O+q,Q=B+A;_.applyITRS(a,s,u,l,h),Y.copyFrom(C.matrix),I?(Y.multiplyWithOffset(I,-C.scrollX*m,-C.scrollY*p),_.e=a,_.f=s,Y.multiply(_,L)):(_.e-=C.scrollX*m,_.f-=C.scrollY*p,Y.multiply(_,L));var W=L.getX(O,B),k=L.getY(O,B),J=L.getX(O,Q),K=L.getY(O,Q),V=L.getX(j,Q),Z=L.getY(j,Q),$=L.getX(j,B),tt=L.getY(j,B);C.roundPixels&&(W=Math.round(W),k=Math.round(k),J=Math.round(J),K=Math.round(K),V=Math.round(V),Z=Math.round(Z),$=Math.round($),tt=Math.round(tt)),this.setTexture2D(e,0),this.batchQuad(W,k,J,K,V,Z,$,tt,P,D,z,U,T,F,N,b,R,e,0)}else console.warn(\"Normal map missing or invalid\")},setNormalMap:function(t){var e;this.active&&t&&(t.texture&&(e=t.texture.dataSource[t.frame.sourceIndex]),e||(e=this.defaultNormalMap),this.setTexture2D(e.glTexture,1),this.renderer.setPipeline(t.defaultPipeline))},setNormalMapRotation:function(t){var e=this.inverseRotationMatrix;if(t){var r=-t,i=Math.cos(r),a=Math.sin(r);e[1]=a,e[3]=-a,e[0]=e[4]=i}else e[0]=e[4]=1,e[1]=e[3]=0;this.renderer.setMatrix3(this.program,\"uInverseRotationMatrix\",!1,e)},batchSprite:function(t,e,i){if(this.active){var a=t.texture.dataSource[t.frame.sourceIndex];a&&(this.renderer.setPipeline(this),this.setTexture2D(a.glTexture,1),this.setNormalMapRotation(t.rotation),r.prototype.batchSprite.call(this,t,e,i))}}});a.LIGHT_COUNT=i,module.exports=a;"},"sourceMaps":null,"error":null,"hash":"3d0d61fe56131dc7bbec065c1cdff4c5","cacheData":{"env":{}}}